---
import Base from '../../layouts/Base.astro';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import { localizedLandingPages, localeMeta, getLocalizedUiStrings, getSiteAlternates, getLocalizedParityFramework } from '../../lib/i18n.js';

export async function getStaticPaths() {
  return Object.keys(localeMeta)
    .filter((locale) => locale !== 'en')
    .map((lang) => ({ params: { lang } }));
}

const { lang } = Astro.params;
const locale = localeMeta[lang];
if (!locale || lang === 'en') {
  throw new Error(`Locale not found: ${lang}`);
}

const pages = localizedLandingPages.filter((page) => page.locale === lang);
const canonical = `https://aitraining.directory/${lang}/`;
const ui = getLocalizedUiStrings(lang);
const parityFramework = getLocalizedParityFramework(lang);
const alternates = getSiteAlternates().map((alt) => {
  if (alt.hreflang === 'en' || alt.hreflang === 'x-default') return alt;
  const baseCode = alt.hreflang.split('-')[0];
  return baseCode === lang ? { ...alt, href: canonical } : alt;
});

const copy = {
  pl: {
    edition: 'Wersja polska',
    title: 'Polski: strony o AI szkoleniach',
    intro: 'Zlokalizowane strony dla zespołów L&D i enablement w Polsce. Zacznij od strony z intencją rynkową.',
    browse: 'Przeglądaj wszystkie kategorie',
    solutions: 'Otwórz scenariusze wdrożenia',
    listTitle: 'Dostępne strony lokalne',
    checklistTitle: 'Checklist wdrożenia dla rynku lokalnego'
  },
  cs: {
    edition: 'Česká verze',
    title: 'Čeština: stránky pro AI školení',
    intro: 'Lokalizované stránky pro L&D a enablement týmy v Česku. Začněte stránkou podle tržního záměru.',
    browse: 'Procházet všechny kategorie',
    solutions: 'Otevřít scénáře nasazení',
    listTitle: 'Dostupné lokalizované stránky',
    checklistTitle: 'Implementační checklist pro lokální trh'
  },
  sk: {
    edition: 'Slovenská verzia',
    title: 'Slovenčina: stránky pre AI školenia',
    intro: 'Lokalizované stránky pre L&D a enablement tímy na Slovensku. Začni stránkou podľa trhového intentu.',
    browse: 'Prehliadať všetky kategórie',
    solutions: 'Otvoriť scenáre nasadenia',
    listTitle: 'Dostupné lokalizované stránky',
    checklistTitle: 'Implementačný checklist pre lokálny trh'
  },
  hu: {
    edition: 'Magyar kiadás',
    title: 'Magyar: AI képzési oldalak',
    intro: 'Lokalizált oldalak magyar L&D és enablement csapatoknak. Kezdj egy piaci szándékhoz illő oldallal.',
    browse: 'Összes kategória böngészése',
    solutions: 'Megoldási útmutatók megnyitása',
    listTitle: 'Elérhető lokalizált oldalak',
    checklistTitle: 'Lokális bevezetési checklist'
  },
  de: {
    edition: 'Deutsche Version',
    title: 'Deutsch: KI-Trainingsseiten',
    intro: 'Lokalisierte Seiten für L&D- und Enablement-Teams im DACH-Raum. Starten Sie mit einer marktintenten Seite.',
    browse: 'Alle Kategorien ansehen',
    solutions: 'Lösungs-Playbooks öffnen',
    listTitle: 'Verfügbare lokalisierte Seiten',
    checklistTitle: 'Implementierungs-Checklist für den lokalen Markt'
  },
  es: {
    edition: 'Edición en español',
    title: 'Español: páginas de IA para formación',
    intro: 'Páginas localizadas para equipos de L&D y enablement. Empieza con una página alineada con la intención del mercado.',
    browse: 'Ver todas las categorías',
    solutions: 'Abrir guías de implementación',
    listTitle: 'Páginas localizadas disponibles',
    checklistTitle: 'Checklist de implementación para mercado local'
  }
}[lang] || {
  edition: `${locale.name} edition`,
  title: `${locale.name}: AI training pages`,
  intro: `Localized AI training pages for ${locale.name} market intent.`,
  browse: 'Browse all categories',
  solutions: 'Open solution playbooks',
  listTitle: 'Available localized pages',
  checklistTitle: 'Localized rollout checklist'
};

const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'CollectionPage',
  inLanguage: lang,
  name: `${locale.name} AI training pages`,
  url: canonical
};
---
<Base title={`${locale.name} | AI Training Directory`} description={`Localized AI training and L&D pages for ${locale.name} market intent.`} canonical={canonical} jsonLd={jsonLd} lang={lang} alternates={alternates}>
  <Breadcrumbs items={[{ label: ui.home, href: `/${lang}/` }, { label: locale.name, href: `/${lang}/` }]} />

  <section class="hero" style="margin-bottom:1.25rem;">
    <span class="eyebrow">{copy.edition}</span>
    <h1 style="margin-top:.7rem;">{copy.title}</h1>
    <p class="muted" style="max-width:70ch;">{copy.intro}</p>
    <div class="hero-actions">
      <a class="btn btn-primary" href="/categories/">{copy.browse}</a>
      <a class="btn btn-secondary" href="/solutions/">{copy.solutions}</a>
    </div>
  </section>

  <section aria-labelledby="localized-pages-heading">
    <h2 id="localized-pages-heading">{copy.listTitle}</h2>
    <div class="grid">
      {pages.map((page) => (
        <a class="card" href={`/${page.locale}/${page.slug}/`}>
          <h3 style="margin:0 0 .5rem 0;">{page.h1}</h3>
          <p class="muted" style="margin:0;">{page.description}</p>
        </a>
      ))}
    </div>
  </section>

  <section class="section card" aria-labelledby="localized-checklist-heading">
    <h2 id="localized-checklist-heading">{copy.checklistTitle}</h2>
    <ul>
      {parityFramework.hubChecklist.map((item) => <li>{item}</li>)}
    </ul>
  </section>

  <section class="section card" aria-labelledby="localized-trust-heading">
    <h2 id="localized-trust-heading">{parityFramework.hubTrustHeading}</h2>
    <ul>
      {parityFramework.trustBullets.map((item) => <li>{item}</li>)}
    </ul>
    <div class="chips chips-nav">
      {parityFramework.methodologyLinks.map((item) => (
        <a class="chip" href={item.href}>{item.label}</a>
      ))}
    </div>
  </section>

  <section class="section card" aria-labelledby="localized-routing-heading">
    <h2 id="localized-routing-heading">{parityFramework.routingHeading}</h2>
    <ul>
      {parityFramework.routingChecks.map((item) => <li>{item}</li>)}
    </ul>
  </section>

  <section class="section card" aria-labelledby="localized-parity-heading">
    <h2 id="localized-parity-heading">{parityFramework.heading}</h2>
    <p class="muted">{parityFramework.intro}</p>
    <ul>
      {parityFramework.dimensions.map((dimension) => <li>{dimension.localizedName}</li>)}
    </ul>
  </section>
</Base>
